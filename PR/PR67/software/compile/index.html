
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://orcd.mit.edu/software/compile/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>Building Software from Source Code in Linux - ORCD Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#building-software-from-source-code-in-linux" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ORCD Docs" class="md-header__button md-logo" aria-label="ORCD Docs" data-md-component="logo">
      
  <img src="../../images/ORCD_logo_icononly.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ORCD Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Building Software from Source Code in Linux
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ORCD Docs" class="md-nav__button md-logo" aria-label="ORCD Docs" data-md-component="logo">
      
  <img src="../../images/ORCD_logo_icononly.png" alt="logo">

    </a>
    ORCD Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../orcd-systems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ORCD Systems
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started Tutorial
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Filesystems and File Transfer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Filesystems and File Transfer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../filesystems-file-transfer/filesystems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General Use Filesystems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../filesystems-file-transfer/project-filesystems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Specific Filesystems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../filesystems-file-transfer/transferring-files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transferring Files
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Software
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Software
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ORCD Recipes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            ORCD Recipes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/mujoco/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MuJoCo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/nvhpc-a100-with-cuda-and-mpi-example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NVHPC with CUDA aware MPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/gromacs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GROMACS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/mpi4py/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MPI for Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/mpi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MPI jobs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/relion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RELION
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VSCode
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../acknowledgements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledging Us
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Security and Privacy
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-of-conduct/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acceptable Use and Code of Conduct
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-help/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Help
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-single-file-program" class="md-nav__link">
    <span class="md-ellipsis">
      Building a single-file program
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building a single-file program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-preprocess" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Preprocess
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-compile" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Compile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  
<nav class="md-tags" >
  
    
    
    
      <a href="../../tags/#software" class="md-tag">Software</a>
    
  
    
    
    
      <a href="../../tags/#cc" class="md-tag">C/C++</a>
    
  
    
    
    
      <a href="../../tags/#engaging" class="md-tag">Engaging</a>
    
  
    
    
    
      <a href="../../tags/#openmind" class="md-tag">OpenMind</a>
    
  
</nav>



<h1 id="building-software-from-source-code-in-linux">Building Software from Source Code in Linux</h1>
<p>This page covers the basics of building small projects from C source code, and automating this process using GNU Make. It is intended for scientists venturing into scientific programming, to help ease the frustrations that typically come up when starting to work in compiled programming languages.</p>
<h2 id="preparation">Preparation</h2>
<p>A GCC compiler is needed to compile codes. Load a GCC module, 
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>module load gcc/12.2.0-x86_64
</span></code></pre></div></p>
<h2 id="building-a-single-file-program">Building a single-file program</h2>
<p>Let's start with a simple example: building a "hello world" C program with the GCC compiler.</p>
<p>Our program (hello.c) looks like this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>#include &lt;stdio.h&gt;
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>main()
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>{
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    (void) printf(&quot;Hello World\n&quot;);
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    return (0);
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>}
</span></code></pre></div>
<p>To build a working executable from this file in the simplest way possible, run:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>gcc hello.c
</span></code></pre></div>
<p>This command creates an executable with a default name of a.out. Running this command prints the familiar message:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$ a.out
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Hello World
</span></code></pre></div>
<p>More happened here behind the scene. In fact, this command wraps up 4 steps of the build process: Preprocess, Compile, Assemble, and Link.</p>
<h3 id="step-1-preprocess">Step 1: Preprocess</h3>
<p>In this step, gcc calls preprocessing program cpp to interpret preprocessor directives and modify the source code accordingly.</p>
<p>Some common directives are:</p>
<ul>
<li>
<p><code>#include</code>: includes contents of the named file, typically a header file, e.g. <code>#include &lt;stdio.h&gt;</code></p>
</li>
<li>
<p><code>#define</code>: macro substitution, e.g. <code>#define PI 3.14159</code></p>
</li>
<li>
<p><code>#ifdef ... #end</code>: conditional compilation, the code block is included only if a certain macro is defined, e.g:
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>#ifdef TEST_CASE
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>a=1; b=0; c=0;
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>#endif
</span></code></pre></div></p>
</li>
</ul>
<p>We could perform just this step of the build process like so:
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>cpp hello.c hello.i
</span></code></pre></div></p>
<p>Examining the output file (<code>vim hello.i</code>) shows that the long and messy <code>stdio.h</code> header has been appended to our simple code. </p>
<h3 id="step-2-compile">Step 2: Compile</h3>
<p>In this step, the (modified) source code is translated from the C programming language into assembly code.</p>
<p>Assembly code is a low-level programming language with commands that correspond to machine instructions for a particular type of hardware. It is still just plain text --- you can read assembly and write it too if you so desire.</p>
<p>To perform just the compilation step of the build process, we would run:</p>
<p>gcc -S -c hello.i -o hello.i
Examining the output file (vim hello.s) shows that processor-specific instructions needed to run our program on this specific system. Interestingly, for such a simple program as ours, the assembly code is actually shorter than the preprocesses source code (though not the original source code).</p>
<p>Step 3: Assemble
Assembly code is then translated into object code (more). This is a binary representation of the actions your computer needs to take to run your program. It is no longer human-readable, but it can be understood by your processor.</p>
<p>To perform just this step of the build process, we would run:</p>
<p>gcc -c hello.s -o hello.o
You can try to view this object file like we did the other intermediate steps, but the result will not be terribly useful (vim hello.o). Your text editor is trying to interpret binary machine language commands as ASCII characters, and (mostly) failing. Perhaps the most interesting result of doing so is that there are intelligable bits --- these are the few variables, etc, that actually are ASCII characters.</p>
<p>Also note that object files are not executables, you can't run them until after the next step.</p>
<p>Step 4: Link
In the final step, gcc calls the linker program ld to combine the object file with any external functions it needs (e.g. library functions or functions from other source files). In our case, this would include printf from the C standard library.</p>
<p>To perform just this step of the build process, we would run:</p>
<p>gcc hello.o -o hello
Challege:
Compile and run the following program (squares.c):</p>
<h1 id="include">include <stdio.h></h1>
<p>main()
{ 
    int i;</p>
<div class="language-text highlight"><pre><span></span><code>printf(&quot;\t Number \t\t Square of Number\n\n&quot;);

for (i=0; i&lt;=25; ++i)
printf(&quot;\t %d \t\t\t %d \n&quot;, i, i*i);
</code></pre></div>
<p>}
If you have some extra time, try walking through the process step-by-step and inspecting the results.</p>
<p>Solution:
gcc squares.c -o squares
./squares
Building a multi-file program
For all but the smallest programming projects, it is convenient to break up the source code into multiple files. Typically, these include a main function in one file, and one or more other files containing functions / subroutines called by main(). In addition, a header file is usually used to share custom data types, function prototypes, preprocessor macros, etc.</p>
<p>We will use a simple example program in the multi_string folder, which consists of:</p>
<p>main.c: The main driver function, which calls a subroutine and exits
WriteMyString.c: a module containing the subroutine called by main
header.h: one function prototype and one macro definition
The easiest way to compile such a program is to include all the required source files at the gcc command line:</p>
<p>gcc main.c WriteMyString.c -o my_string
./my_string
It is also quite common to separate out the process into two steps:</p>
<p>source code -&gt; object code
object code -&gt; executable (or library)
The reason is that this allows you to reduce compiling time by only recompiling objects that need to be updated. This seems (and is) silly for small projects, but becomes important quickly. We will use this approach later when we discuss automating the build process.</p>
<p>gcc -c WriteMyString.c
gcc -c main.c
gcc WriteMyString.o main.o -o write
./write
Including header files
Note that it is not necessary to include the header file on the gcc command line. This makes sense since we know that the (bundeled) preprocessing step will append any required headers to the source code before it is compiled.</p>
<p>There is one caveat: the preprocessor must be able to find the header files in order to include them. Our example works because header.h is in the working directory when we run gcc. We can break it by moving the header to a new subdirectory, like so:</p>
<p>mkdir hdr
mv header.c hdr
gcc main.c WriteMyString.c -o my_string
The above commands give the output error:</p>
<p>main.c:4:20: fatal error: header.h: No such file or directory
 #include "header.h"
                    ^
compilation terminated.
We can fix this by specifically telling gcc where it can find the requisite headers, using the -I flag:</p>
<p>gcc -I ./hdr main.c WriteMyString.c -o my_string
This is most often need in the case where you wish to use external libraries installed in non-standard locations. We will explore this case below.</p>
<p>Challenge
In the folder multi_fav_num you will find another simple multi-file program. Build this source code to a program named fav_num using separate compile and link steps. Once you have done this successfully, change the number defined in other.c and rebuild. You should not have to recompile main.c to do this.</p>
<p>Solution:
gcc -c main.c
gcc -c other.c
gcc main.o other.o -o fav_num
./fav_num</p>
<p>vim other.c</p>
<p>gcc -c other.c
gcc main.o other.o -o fav_num
./fav_num
Linking external libraries
NOTE: content in this section is (lightly) modified from this site.</p>
<p>A library is a collection of pre-compiled object files that can be linked into your programs via the linker. In simpler terms, they are machine code files that contain functions, etc, you can use in your programs.</p>
<p>A few example functions that come from libraries are:</p>
<p>printf() from the libc.so shared library
sqrt() from the libm.so shared library
We will return to these in a moment.</p>
<p>Shared libraries vs static libraries
A static library has file extension of .a (archive file). When your program links a static library, the machine code of external functions used in your program is copied into the executable. At runtime, everything your program needs is wrapped up inside the executable.</p>
<p>A shared library has file extension of ".so" (shared objects). When your program is linked against a shared library, only a small table is created in the executable. At runtime, the exectutable must be able to locate the functions listed in this table. This is done by the operating system - a process known as dynamic linking.</p>
<p>Static libraries certainly seem simpler, but most programs use shared libraries and dynamic linking. There are several reasons why the added complexity is thought to be worth it:</p>
<p>Makes executable files smaller and saves disk space, because one copy of a library can be shared between multiple programs.
Most operating systems allow one copy of a shared library in memory to be used by all running programs, saving memory.
If your libraries are updated, programs using shared libraries automatically take advantage of these updates, programs using static libraries would need to be recompiled.
Because of the advantage of dynamic linking, GCC will prefer a shared library to a static library if both are available (by default).</p>
<p>Building with shared libraries in default (known) locations
Let's start with an example that uses the sqrt() function from the math library:</p>
<h1 id="include_1">include <stdio.h></h1>
<h1 id="include_2">include <math.h></h1>
<p>void main()
{ 
    int i;</p>
<div class="language-text highlight"><pre><span></span><code>printf(&quot;\t Number \t\t Square Root of Number\n\n&quot;);

for (i=0; i&lt;=360; ++i)
    printf(&quot;\t %d \t\t\t %d \n&quot;, i, sqrt((double) i));
</code></pre></div>
<p>}
Notice the function sqrt, which we use, but do not define. The (machine) code for this function is stored in libm.so, and the function definition is stored in the header file math.h.</p>
<p>To build successfully, we must:</p>
<h1 id="include-the-header-file-for-the-external-library">include the header file for the external library</h1>
<p>Make sure that the preprocessor can find this header file
Instruct the linker to link to the external library
Let's go ahead and build the program. To compile and link this in separate steps, we would run:</p>
<p>gcc -c roots.c
gcc roots.o -lm -o roots
The first command preprocesses roots.c, appending the header files, and then translates it to object code. This step does need to find the header file, but it does not yet require the library.</p>
<p>The second command links all of the object code into the executable. It does not need to find the header file (it is already compiled into roots.o) but it does need to find the library file.</p>
<p>Library files are included using the -l flag. Thier names are given excluding the lib prefix and exluding the .so suffix.</p>
<p>Just as we did above, we can combine the build steps into a single command:</p>
<p>gcc roots.c -lm -o roots
IMPORTANT Because we are using shared libraries, the linker must be able to find the linked libraries at runtime, otherwise the program will fail. You can check the libraries required by a program, and whether they are being found correctly or not using the ldd command. For out roots program, we get the following</p>
<p>ldd roots
linux-vdso.so.1 =&gt;  (0x00007fff8bb8a000)
libm.so.6 =&gt; /lib64/libm.so.6 (0x00007ffc69550000)
libc.so.6 =&gt; /lib64/libc.so.6 (0x00007ffc691bc000)
/lib64/ld-linux-x86-64.so.2 (0x00007ffc69801000)
Which shows that our executable requires a few basic system libraries as well as the math library we explicitly included, and that all of these dependencies are found by the linker.</p>
<p>Challenge
Before moving on, let's take a few minutes to break this build process. Try the following and read the error messages carefully. These are your hints to fixing a broken build process.</p>
<p>Delete #include <math.h> from roots.c
Omit -lm from the linking step
Sidebar: where does the preprocessor look to find header files?
The preprocessor will search some default paths for included header files. Before we go down the rabbit hole, it is important to note that you do not have to do this for a typical build, but the commands may prove useful when you are trying to work out why something fails to build.</p>
<p>o look for the header, we can run the following commands to show the preprocessor search path and look for files in therein:</p>
<p>cpp -Wp,-v
Which has the following output:</p>
<p>ignoring nonexistent directory "/usr/local/include"
ignoring nonexistent directory "/usr/lib/gcc/x86_64-redhat-linux/4.4.7/include-fixed"
ignoring nonexistent directory "/usr/lib/gcc/x86_64-redhat-linux/4.4.7/../../../../x86_64-redhat-linux/include"</p>
<h1 id="include-search-starts-here">include "..." search starts here:</h1>
<h1 id="include-search-starts-here_1">include &lt;...&gt; search starts here:</h1>
<p>/usr/lib/gcc/x86_64-redhat-linux/4.4.7/include
  /usr/include
  End of search list.
  ^C
The last few lines show the paths where GCC will search for header files by default. We can then search these include paths for the file we want, math.h like so:</p>
<p>find /usr/include /usr/lib/gcc/x86_64-redhat-linux/4.4.7/include -name math.h
Which has the following output:</p>
<p>/usr/include/FL/math.h
/usr/include/c++/4.4.4/tr1/math.h
/usr/include/math.h
If we are really curious, we could open the header and see what it contains, but this is rarely necessary.</p>
<p>Sidebar: where does the linker look to find libraries?
The linker will search some default paths for included library files. Again, it is important to note that you do not have to do this for a typical build, but the commands may prove useful when you are trying to work out why something fails to build.</p>
<p>To look for the library, we can run the following command to get a list of all library files the linker is aware of, then search that list for the math library we need:</p>
<p>ldconfig -p 
ldconfig -p | grep libmath
The latter command gives the output:</p>
<p>libm.so.6 (libc6,x86-64, OS ABI: Linux 2.6.18) =&gt; /lib64/libm.so.6
libm.so.6 (libc6, hwcap: 0x0028000000000000, OS ABI: Linux 2.6.18) =&gt; /lib/i686/nosegneg/libm.so.6
libm.so.6 (libc6, OS ABI: Linux 2.6.18) =&gt; /lib/libm.so.6
libm.so (libc6,x86-64, OS ABI: Linux 2.6.18) =&gt; /usr/lib64/libm.so
libm.so (libc6, OS ABI: Linux 2.6.18) =&gt; /usr/lib/libm.so
We certainly have the math library available. In fact, there are a few versions of this library known to the linker. Thankfully, we can let the linker sort out which one to use.</p>
<p>We might also want to peek inside a library file (or any object code for that matter) to see what functions and variables are defined within. We can list all the names, then search for the one we care about, like so:</p>
<p>nm /lib/libm.so.6
nm /lib/libm.so.6 | sqrt
The output of this command contains the following line, which shows us that it does indeed include something called sqrt.</p>
<p>0000000000025990 W sqrt
Building with shared libraries in non-default (unknown) locations
note: the following command lines build the libctest.so shared library used in the example below:</p>
<p>gcc -Wall -fPIC -c ctest1.c ctest2.c
gcc -shared -Wl,-soname,libctest.so -o libctest.so ctest1.o ctest2.o
end note</p>
<p>Let's switch to a new bit of example code, called use_ctest.c that makes use of a (very simple) custom library in the ctest directory:</p>
<h1 id="include_3">include <stdio.h></h1>
<h1 id="include-ctesth">include "ctest.h"</h1>
<p>int main(){
    int x;
    int y;
    int z;
    ctest1(&amp;x);
    ctest2(&amp;y);
    z = (x / y);
    printf("%d / %d = %d\n", x, y, z);
    return 0;
}
Trying to compile this fails with an error:</p>
<p>gcc -c use_ctest.c</p>
<p>use_ctest.c:2:19: error: ctest.h: No such file or directory
As the error message indicates, the problem here is that an included header file is not found by the preprocessor. We can use the -I flag to fix this problem:</p>
<p>gcc -I ctest_dir/include -c use_ctest.c
When we try to link the program to create an executable, we know we need to explicitly add the library with the -l flag, but in this case we still get an error:</p>
<p>gcc use_ctest.o -lctest -use_ctest</p>
<p>/usr/bin/ld: cannot find -lctest
collect2: ld returned 1 exit status
Just like for the header, we need to explicitly specify the path to the library file:</p>
<p>gcc -Lctest_dir/lib  use_ctest.o -lctest use_ctest
Success, or so it would seem. What happens when we try to run our shiny new executable?</p>
<p>./ctest</p>
<p>./ctest: error while loading shared libraries: libctest.so: cannot open shared object file: No such file or directory
We can diagnose this problem by checking to see if the dynamic linker is able to gather up all the dependencies at runtime:</p>
<p>ldd ctest</p>
<p>linux-vdso.so.1 =&gt;  (0x00007fffd75ff000)
libctest.so =&gt; not found
libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f802d21b000)
/lib64/ld-linux-x86-64.so.2 (0x00007f802d5dd000)
The output clearly shows that it does not. The problem here is that the dynamic linker will only search the default paths unless we:</p>
<p>Permanently add our custom library to this search path. This option is not covered here - I am assuming that many of you will be working on clusters and other systems where you do not have root permissions.</p>
<p>Specify the location of non-standard libraries using the LD_LIBRARY_PATH variable. LD_LIBRARY_PATH contains a colon (:) separated list of directories where the dynamic linker should look for shared libraries. The linker will search these directories before the default system paths. You can define the value of LD_LIBRARY_PATH for a particular command only by preceeding the command with the definintion, like so:</p>
<p>LD_LIBRARY_PATH=ctest_dir/lib:$LD_LIBRARY_PATH ./use_ctest
Or define it for your whole shell as an environment variable:</p>
<p>export LD_LIBRARY_PATH=/ctest_dir/lib:$LD_LIBRARY_PATH
./use_ctest
Hard-code the location of non-standard libraries into the executable. Setting (and forgeting to set) LD_LIBRARY_PATH all the time can be tiresome. An alternative approach is to burn the location of the shared libraries into the executable as an RPATH or RUNPATH. This is done by adding some additional flags for the linker, like so:</p>
<p>gcc -Lctest_dir/lib  use_ctest.o -lctest -Wl,rpath,ctest_dir/lib,--enable-new-dtags- use_ctest
We can confirm that this worked by running the program (resetting LD_LIBRARY_PATH first if needed), and more explicitly, by examining the executable directly:</p>
<p>./use_ctest
readelf -d use_ctest
Challenge
Without using your history, try to re-compile and run the use_ctest program. For an additional challenge, try to do so using RUNPATH to hardcode the location of the shared library.</p>
<p>Automating the build process with GNU Make
The manual build process we used above can become quite tedious for all but the smallest projects. There are many ways that we might automate this process. The simplest would be to write a shell script that runs the build commands each time we invoke it. Let's take the simple hello.c program as a test case:</p>
<h1 id="binbash">!/bin/bash</h1>
<p>gcc -c hello.c
gcc hello.o -o hello
This works fine for small projects, but for large multi-file projects, we would have to compile all the sources every time we change any of the sources.</p>
<p>The Make utility provides a useful way around this problem. The solution is that we (the programmer) write a special script that defines all the dependencies between source files, edit one or more files in our project, then invoke Make to re-compile only those files that are affected by any changes.</p>
<p>Make is a mini-programming language unto itself, so I will only touch upon the simplest useage. For the hello program, a makefile might look like this:</p>
<p>hello: hello.o
    gcc hello.o -o hello</p>
<p>hello.o: hello.c
    gcc -c hello.c</p>
<p>clean:
    rm hello hello.o</p>
<p>.PHONY: clean
The syntax here is target: prerequisite_1 prerequisite_2 etc. The command block that follows will be executed to generate the target if any of the prerequisites have been modified. The first (top) target will be built by default, or you can specify a specific target to build following the make command. When we run make for the first time, the computer will take the following actions:</p>
<p>Find the default target, which is our executable file hello.
Check to see if hello is up-to-date, hello does not exist, so it is not up-to-date and will have to be built
Check to see if the prerequisite hello.o is up-to-date, hello.o does not exist, so it is not up-to-date and will have to be built.
The prerequisite hello.c is not a target, so there is nothing left to check. The command gcc -c hello.c will be run to build hello.o
Now hello.o is up to date, so make builds the next target, hello by running the command gcc hello.o -o hello
Done.
We can then compile using the make command:</p>
<p>make clean 
make
Notice that if no changes are made to the source files, make does not recompile anything --- there is no need to do so.</p>
<p>Let's look at an example for our first multi-file program:</p>
<p>write: main.o WriteMyString.o
        gcc main.o WriteMyString.o -o write</p>
<p>main.o: main.c header.h
        gcc -c main.c</p>
<p>WriteMyString.o: WriteMyString.c
        gcc -c WriteMyString.c</p>
<p>clean: 
        rm write *.o</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">July 3, 2024</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="https://accessibility.mit.edu/">Accessibility</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>