
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://orcd.mit.edu/software/compile/">
      
      
        <link rel="prev" href="../apptainer/">
      
      
        <link rel="next" href="../julia/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.3">
    
    
      
        <title>Compiling Codes - ORCD Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.d7758b05.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#compiling-source-code-and-gnu-make" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ORCD Docs" class="md-header__button md-logo" aria-label="ORCD Docs" data-md-component="logo">
      
  <img src="../../images/ORCD_logo_icononly.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ORCD Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Compiling Codes
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ORCD Docs" class="md-nav__button md-logo" aria-label="ORCD Docs" data-md-component="logo">
      
  <img src="../../images/ORCD_logo_icononly.png" alt="logo">

    </a>
    ORCD Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../orcd-systems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ORCD Systems
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started Tutorial
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Accessing ORCD Systems
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Accessing ORCD Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../accessing-orcd/ondemand-login/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging in with OnDemand
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../accessing-orcd/ssh-login/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging in with SSH via Terminal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../accessing-orcd/ssh-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSH Key Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VSCode Remote SSH
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Filesystems and File Transfer
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Filesystems and File Transfer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../filesystems-file-transfer/filesystems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General Use Filesystems
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../filesystems-file-transfer/project-filesystems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Specific Filesystems
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../filesystems-file-transfer/transferring-files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transferring Files
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Software
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Software
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apptainer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Compiling Codes
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Compiling Codes
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-single-file-program" class="md-nav__link">
    <span class="md-ellipsis">
      Building a single-file program
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building a single-file program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-preprocess" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Preprocess
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-compile" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Compile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-assemble" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Assemble
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-link" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Link
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-multi-file-program" class="md-nav__link">
    <span class="md-ellipsis">
      Building a multi-file program
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building a multi-file program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#including-header-files" class="md-nav__link">
    <span class="md-ellipsis">
      Including header files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linking-external-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Linking external libraries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linking external libraries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shared-libraries-vs-static-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Shared libraries vs static libraries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-with-libraries-in-default-locations" class="md-nav__link">
    <span class="md-ellipsis">
      Building with libraries in default locations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-with-libraries-in-non-default-locations" class="md-nav__link">
    <span class="md-ellipsis">
      Building with libraries in non-default locations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automating-the-build-process-with-gnu-make" class="md-nav__link">
    <span class="md-ellipsis">
      Automating the build process with GNU Make
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Automating the build process with GNU Make">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-gnu-make-works" class="md-nav__link">
    <span class="md-ellipsis">
      How GNU Make works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefile-for-a-multi-file-program" class="md-nav__link">
    <span class="md-ellipsis">
      Makefile for a multi-file program
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-a-good-makefile" class="md-nav__link">
    <span class="md-ellipsis">
      Writing a good Makefile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../julia/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Julia
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../R/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    R
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Running Jobs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Running Jobs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running-jobs/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scheduler Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running-jobs/requesting-resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Requesting Resources
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ORCD Recipes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            ORCD Recipes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/mujoco/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MuJoCo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/nvhpc-a100-with-cuda-and-mpi-example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NVHPC with CUDA aware MPI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/gromacs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GROMACS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/mpi4py/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MPI for Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/mpi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MPI jobs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/relion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RELION
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VSCode Remote SSH
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/pycharm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyCharm
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../acknowledgements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledging Us
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Security and Privacy
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-of-conduct/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acceptable Use and Code of Conduct
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-help/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Help
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-single-file-program" class="md-nav__link">
    <span class="md-ellipsis">
      Building a single-file program
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building a single-file program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-preprocess" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Preprocess
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-compile" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Compile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-assemble" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Assemble
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-link" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Link
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-multi-file-program" class="md-nav__link">
    <span class="md-ellipsis">
      Building a multi-file program
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building a multi-file program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#including-header-files" class="md-nav__link">
    <span class="md-ellipsis">
      Including header files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linking-external-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Linking external libraries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linking external libraries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shared-libraries-vs-static-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Shared libraries vs static libraries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-with-libraries-in-default-locations" class="md-nav__link">
    <span class="md-ellipsis">
      Building with libraries in default locations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-with-libraries-in-non-default-locations" class="md-nav__link">
    <span class="md-ellipsis">
      Building with libraries in non-default locations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automating-the-build-process-with-gnu-make" class="md-nav__link">
    <span class="md-ellipsis">
      Automating the build process with GNU Make
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Automating the build process with GNU Make">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-gnu-make-works" class="md-nav__link">
    <span class="md-ellipsis">
      How GNU Make works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefile-for-a-multi-file-program" class="md-nav__link">
    <span class="md-ellipsis">
      Makefile for a multi-file program
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-a-good-makefile" class="md-nav__link">
    <span class="md-ellipsis">
      Writing a good Makefile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags" >
    
      
      
      
        <a href="../../tags/#tag:cc" class="md-tag">C/C++</a>
      
    
      
      
      
        <a href="../../tags/#tag:engaging" class="md-tag">Engaging</a>
      
    
      
      
      
        <a href="../../tags/#tag:openmind" class="md-tag">OpenMind</a>
      
    
      
      
      
        <a href="../../tags/#tag:software" class="md-tag">Software</a>
      
    
  </nav>



<h1 id="compiling-source-code-and-gnu-make">Compiling Source Code and GNU Make</h1>
<p>This page covers the basics of building programs from C source code, and automating this process using GNU Make. It is intended for scientists venturing into scientific programming, to help ease the frustrations that typically come up when starting to work in compiled programming languages.</p>
<h2 id="preparation">Preparation</h2>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Engaging</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>A GCC compiler is needed to compile codes. Load a GCC module first, 
 <div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>module load gcc/12.2.0
</span></code></pre></div></p>
</div>
</div>
</div>
<h2 id="building-a-single-file-program">Building a single-file program</h2>
<p>Let's start with a simple example: building a "hello world" C program with the GCC compiler. The program (<em>hello.c</em>) looks like this:
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>#include &lt;stdio.h&gt;
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>int main()
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>{
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    printf(&quot;Hello World\n&quot;);
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    return (0);
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>}
</span></code></pre></div></p>
<p>To build a working executable from this file, run:
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>gcc hello.c -o hello
</span></code></pre></div></p>
<p>This command creates an executable with a name of <em>hello</em>. Running this command prints the familiar message:
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$ ./hello
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Hello World
</span></code></pre></div></p>
<p>More happened here behind the scene. In fact, this command wraps up 4 steps of the build process: Preprocess, Compile, Assemble, and Link.</p>
<h3 id="step-1-preprocess">Step 1: Preprocess</h3>
<p>In this step, <code>gcc</code> calls preprocessing program <code>cpp</code> to interpret preprocessor directives and modify the source code accordingly.</p>
<p>Some common directives are:</p>
<ul>
<li>
<p><code>#include</code>: includes contents of the named file, typically a header file, e.g. <code>#include &lt;stdio.h&gt;</code>.</p>
</li>
<li>
<p><code>#define</code>: macro substitution, e.g. <code>#define PI 3.14159</code>.</p>
</li>
<li>
<p><code>#ifdef ... #end</code>: conditional compilation, the code block is included only if a certain macro is defined, e.g:
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>#ifdef TEST_CASE
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>  a=1; b=0; c=0;
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>#endif
</span></code></pre></div></p>
</li>
</ul>
<p>We could perform just this step of the build process like so:
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>cpp hello.c hello.i
</span></code></pre></div></p>
<p>Examining the output file (<code>vim hello.i</code>) shows that the long and messy <em>stdio.h</em> header has been appended to our simple code. </p>
<h3 id="step-2-compile">Step 2: Compile</h3>
<p>In this step, the (modified) source code is translated from the C programming language into assembly code.</p>
<p>Assembly code is a low-level programming language with commands that correspond to machine instructions for a particular type of hardware. It is still just plain text, that says you can read assembly and write it too if you so desire.</p>
<p>To perform just the compilation step of the build process, we would run:
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>gcc -S -c hello.i -o hello.s
</span></code></pre></div></p>
<p>Examining the output file (<code>vim hello.s</code>) shows processor-specific instructions needed to run our program on this specific system. Interestingly, for such a simple program as ours, the assembly code is actually shorter than the preprocesses source code (though not the original source code).</p>
<h3 id="step-3-assemble">Step 3: Assemble</h3>
<p>Assembly code is then translated into object code. This is a binary representation of the actions your computer needs to take to run your program. It is no longer human-readable, but it can be understood by computers.</p>
<p>To perform just this step of the build process, we would run:
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>gcc -c hello.s -o hello.o
</span></code></pre></div></p>
<p>You can try to view this object file like we did the other intermediate steps (<code>vim hello.o</code>), but the result will not be useful . Your text editor is trying to interpret binary machine language commands as ASCII characters, and (mostly) failing. Perhaps the most interesting result of doing so is that there are intelligable bits --- these are the few variables, etc, that actually are ASCII characters.</p>
<p>Also note that object files are not executables, you can't run them until after the next step.</p>
<h3 id="step-4-link">Step 4: Link</h3>
<p>In the final step, <code>gcc</code> calls the linker program <code>ld</code> to combine the object file with any external functions it needs (e.g. library functions or functions from other source files). In our case, this would include <code>printf</code> from the C standard library.</p>
<p>To perform just this step of the build process, we would run:
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>gcc hello.o -o hello
</span></code></pre></div>
This produces the executable <code>hello</code> finally. </p>
<h2 id="building-a-multi-file-program">Building a multi-file program</h2>
<p>For most projects in the real world, it is convenient to break up the source code into multiple files. Typically, these include a main function in one file, and one or more other files containing functions / subroutines called by <code>main()</code>. In addition, a header file is usually used to share custom data types, function prototypes, preprocessor macros, etc.</p>
<p>As an example, we create several source code files in a directory named <em>multi_string</em>, which consists of:</p>
<ul>
<li><em>main.c</em>: the main driver function, which calls a subroutine and exits</li>
<li><em>WriteMyString.c</em>: a module containing the subroutine called by main</li>
<li><em>header.h</em>: one function prototype and one macro definition</li>
</ul>
<details>
<summary>Side note: source codes for the <em>multi_string</em> program</summary>
<p><em>main.c</em>: 
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>#include &quot;header.h&quot;
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>#include &lt;stdio.h&gt;
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>char    *AnotherString = &quot;Hello Everyone&quot;;
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>main()
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>{
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>  printf(&quot;Running...\n&quot;);
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>  WriteMyString(MY_STRING);
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>  printf(&quot;Finished.\n&quot;);
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>}
</span></code></pre></div></p>
<p><em>WriteMyString.c</em>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>#include &lt;stdio.h&gt;
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>extern char *AnotherString;
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>void WriteMyString(char *ThisString)
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>{
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>  printf(&quot;%s\n&quot;, ThisString);
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>  printf(&quot;Global Variable = %s\n&quot;, AnotherString);
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>}
</span></code></pre></div></p>
<p><em>header.h</em>: 
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>#define MY_STRING &quot;Hello World&quot;
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>void WriteMyString();
</span></code></pre></div></p>
</details>
<p>The easiest way to compile such a program is to include all the required source files at the <code>gcc</code> command line:
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>gcc main.c WriteMyString.c -o my_string
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>./my_string
</span></code></pre></div></p>
<p>It is also quite common to separate out the process into two steps:</p>
<ol>
<li>
<p>source code -&gt; object code
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>gcc -c WriteMyString.c
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>gcc -c main.c
</span></code></pre></div></p>
</li>
<li>
<p>object code -&gt; executable (or library)
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>gcc WriteMyString.o main.o -o my_string
</span></code></pre></div></p>
</li>
</ol>
<p>The reason is that this allows you to reduce compiling time by only recompiling objects that need to be updated. This seems silly for a program with only a few source files, but becomes important when many source files are involved. We will use this approach later when we discuss automating the build process.</p>
<h3 id="including-header-files">Including header files</h3>
<p>In the above process, it is not necessary to include the header file explicitly on the <code>gcc</code> command line. This makes sense since we know that the (bundeled) preprocessing step will append any required headers to the source code before it is compiled.</p>
<p>There is one caveat: the preprocessor must be able to find the header files in order to include them. Our example works because the <em>header.h</em> file is in the current directory when we run <code>gcc</code>. We can break it by moving the header to a new subdirectory, like so:
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>mkdir include
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>mv header.h include
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>gcc main.c WriteMyString.c -o my_string
</span></code></pre></div></p>
<p>The above commands give the output error:
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>main.c:4:10: fatal error: header.h: No such file or directory
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    4 | #include &quot;header.h&quot;
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>      |          ^~~~~~~~~~
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>compilation terminated.
</span></code></pre></div></p>
<p>We can fix this by specifically telling gcc where it can find the requisite headers, using the <code>-I</code> flag:
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>gcc -I ./include main.c WriteMyString.c -o my_string
</span></code></pre></div></p>
<p>This is most often needed in the case where you wish to use external libraries installed in non-standard locations. We will explore this case in the next section. </p>
<h2 id="linking-external-libraries">Linking external libraries</h2>
<p>A library is a collection of pre-compiled object files that can be linked into your programs via the linker. In simpler terms, they are machine code files that contain functions / subroutines that you can use in your programs.</p>
<h3 id="shared-libraries-vs-static-libraries">Shared libraries vs static libraries</h3>
<p>A static library has file extension of <em>.a</em> (meaning archive file). When your program links a static library, the machine code of external functions used in your program is copied into the executable. At runtime, everything your program needs is wrapped up inside the executable.</p>
<p>A shared library has file extension of <em>.so</em> (meaning shared objects). When your program is linked against a shared library, only a small table is created in the executable. At runtime, the exectutable must be able to locate the functions listed in this table. This is done by the operating system - a process known as dynamic linking.</p>
<p>Static libraries certainly seem simpler, but most programs use shared libraries and dynamic linking. There are several reasons why the added complexity is thought to be worth it:</p>
<ul>
<li>Makes executable files smaller and saves disk space, because one copy of a library can be shared between multiple programs.</li>
<li>Most operating systems allow one copy of a shared library in memory to be used by all running programs, saving memory.</li>
<li>If your libraries are updated, programs using shared libraries automatically take advantage of these updates, programs using static libraries would need to be recompiled.</li>
</ul>
<p>Because of the advantage of dynamic linking, GCC will prefer a shared library to a static library if both are available (by default). We will only use shared libraries in the following. </p>
<h3 id="building-with-libraries-in-default-locations">Building with libraries in default locations</h3>
<p>Many useful fuctions are provided by libraries in the operating system. These are two widely-used examples:</p>
<ul>
<li><code>printf()</code> from the <em>libc.so</em> shared library</li>
<li><code>sqrt()</code> from the <em>libm.so</em> shared library</li>
</ul>
<p>In this section, we will introduce how to build a program with shared libraries in the system default locations. Let's start with an example (<em>roots.c</em>) that uses the <code>sqrt()</code> function from the math library:
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>#include &lt;stdio.h&gt;
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>#include &lt;math.h&gt;
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>void main()
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>{ 
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    int i;
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>    printf(&quot;\t Number \t\t Square Root of Number\n\n&quot;);
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>    for (i=0; i&lt;=360; ++i)
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>        printf(&quot;\t %d \t\t\t %d \n&quot;, i, sqrt((double) i));
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>}
</span></code></pre></div></p>
<p>Notice the function <code>sqrt</code>, which we use, but do not define. The (machine) code for this function is stored in <em>libm.so</em>, and the function definition is stored in the header file <em>math.h</em>.</p>
<p>To build successfully, we must:</p>
<ol>
<li>Include the header file for the external library;</li>
<li>Instruct the linker to link to the external library.</li>
</ol>
<p>We build the program using the two-step scheme:
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>gcc -c roots.c
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>gcc roots.o -lm -o roots
</span></code></pre></div></p>
<p>The first command preprocesses <em>roots.c</em>, appending the header files, and then translates it to object code. This step does need to find the header file, but it does not yet require the library.</p>
<p>The second command links all of the object code into the executable. It does not need to find the header file, which has already been compiled into <em>roots.o</em>, but it does need to find the library file.</p>
<p>Library files are linked using the <code>-l</code> flag. Their names are given excluding the <em>lib</em> prefix and exluding the <em>.so</em> suffix, which translates <em>libm.so</em> into <code>m</code> in this case. So we use <code>-lm</code> in the command. </p>
<p>Just as we did above, we can combine the two steps into a single command:
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>gcc roots.c -lm -o roots
</span></code></pre></div></p>
<p>Finally, we can run the programm:
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>./roots
</span></code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because we are using shared libraries, the linker must be able to find the linked libraries at runtime, otherwise the program will fail. You can check the libraries required by a program, and whether they are being found correctly or not using the <code>ldd</code> command. For out <em>roots</em> program, we get the following
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>$ ldd roots
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>linux-vdso.so.1 (0x00007ffd2c962000)
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fceadbef000)
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fcead82a000)
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>/lib64/ld-linux-x86-64.so.2 (0x00007fceadf71000)
</span></code></pre></div></p>
<p>This shows that our executable requires a few basic system libraries such as <em>libc.so</em> as well as the math library <code>libm.so</code> we explicitly included, and that all of these dependencies are found by the linker.</p>
</div>
<details>
<summary>Side note: where does the preprocessor look to find header files?</summary>
<p>The preprocessor will search some default paths for included header files. Before we go down the rabbit hole, it is important to note that you do not have to do this for a typical build, but the commands may prove useful when you are trying to work out why something fails to build.</p>
<p>To look for the header, we can run the following command to show the preprocessor search path:
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>cpp -Wp,-v
</span></code></pre></div>
The output show the paths where GCC will search for header files by default. </p>
</details>
<details>
<summary>Side note: where does the linker look to find libraries?</summary>
<p>The linker will search some default paths for library files. Again, it is important to note that you do not have to do this for a typical build, but the commands may prove useful when you are trying to work out why something fails to build.</p>
<p>To look for the library, we can run the following command to get a list of all library files the linker is aware of, 
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>ldconfig -p 
</span></code></pre></div>
or search that list for the math library we need:
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>ldconfig -p | grep libm.so
</span></code></pre></div>
The latter command gives the output:
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>libm.so.6 (libc6,x86-64, OS ABI: Linux 3.2.0) =&gt; /lib64/libm.so.6
</span></code></pre></div>
which shows that the math library is available. </p>
<p>We might also want to peek inside a library file (or any object code for that matter) to see what functions and variables are defined within. We can list all the names, then search for the one we care about, like so:
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>nm /lib64/libm.so.6 | grep &quot; sqrt&quot;
</span></code></pre></div>
The output of this command contains the following line, which shows that it does indeed include something called <code>sqrt</code>.
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>000000000000f7d0 W sqrt
</span></code></pre></div></p>
</details>
<h3 id="building-with-libraries-in-non-default-locations">Building with libraries in non-default locations</h3>
<p>In many cases, you may need to use external libraries that are not included in the operating system. These libraries can be built by you or other develepers and they are saved in non-default locations. In this section, we will introduce how to build a program with libraries in non-default locations. </p>
<p>Let's switch to a new example code. We create a source code named <em>use_ctest.c</em> that reads the following:
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>#include &lt;stdio.h&gt;
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>#include &quot;ctest.h&quot;
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>int main(){
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>    int x;
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>    int y;
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>    int z;
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>    ctest1(&amp;x);
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>    ctest2(&amp;y);
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>    z = (x / y);
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>    printf(&quot;%d / %d = %d\n&quot;, x, y, z);
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>    return 0;
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>}
</span></code></pre></div>
This code calls two functoins <code>ctest1</code> and <code>ctest2</code>, which are included in a custom library named <em>ctest</em>.</p>
<details>
<summary>Side note: building a library</summary>
<p>In the same level of the main code <em>use_ctest.c</em>, we create a directory named <em>ctest_dir</em> to save all files related to the library <em>ctest</em>. 
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>mkdir ctest_dir
</span></code></pre></div></p>
<p>First, create a subdirectory named <code>src</code>, 
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>cd ctest_dir
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>mkdir src
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>cd src
</span></code></pre></div>
and save the following two source code files in there. </p>
<p><em>ctest1.c</em>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>void ctest1(int *i){
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>  *i=100;
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>}
</span></code></pre></div></p>
<p><em>ctest2.c</em>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>$ cat ctest2.c 
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>void ctest2(int *i){
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>  *i=5;
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>}
</span></code></pre></div></p>
<p>Each code does nothing but defines an interger.</p>
<p>Second, create another subdirectory named <code>include</code>,
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>mkdir include
</span></code></pre></div>
and save the following header file in there,
<em>ctest.h</em>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>#ifndef CTEST_H
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>#define CTEST_H
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>void ctest1(int *);
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>void ctest2(int *);
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>#endif
</span></code></pre></div>
This is for the declaration of the funtcions.</p>
<p>Third, use the following commands to build the shared library named <code>libctest.so</code>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>gcc -Wall -fPIC -c ctest1.c ctest2.c
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>gcc -shared -Wl,-soname,libctest.so -o libctest.so ctest1.o ctest2.o
</span></code></pre></div></p>
<p>Finally, we move the library to a directory named <em>lib</em>, 
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>cd ..
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>mkidr lib
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>mv src/libctest.so lib
</span></code></pre></div></p>
</details>
<p>Assuming that the library <em>ctest</em> has been built (as instructed in the above side note), we will build the program <em>use_ctest</em> and fix possbile errors in the process.</p>
<p>First, we start with the simplest command:
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>gcc -c use_ctest.c
</span></code></pre></div>
It fails with an error:
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>use_ctest.c:2:10: fatal error: ctest.h: No such file or directory
</span></code></pre></div></p>
<p>As the error message indicates, the problem here is that an included header file is not found by the preprocessor. We know that we can use the <code>-I</code> flag to fix this problem:
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>gcc -I ctest_dir/include -c use_ctest.c
</span></code></pre></div>
then it creates an object file <em>use_ctest.o</em>.</p>
<p>The next step is to use the linker to create an executable. As we have known, we need to explicitly add the library with the <code>-l</code> flag,
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>gcc use_ctest.o -lctest -use_ctest
</span></code></pre></div>
but in this case we still get an error:
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>/usr/bin/ld: cannot find -lctest
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>collect2: error: ld returned 1 exit status
</span></code></pre></div>
Just like for the header, we need to explicitly specify the path to the library file using <code>-L</code>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>gcc -L ctest_dir/lib  use_ctest.o -lctest -o use_ctest
</span></code></pre></div>
An executable <em>use_ctest</em> is created successfully! </p>
<p>Howerver, what happens when we try to run our shiny new executable?
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>$ ./use_ctest 
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>./use_ctest: error while loading shared libraries: libctest.so: cannot open shared object file: No such file or directory
</span></code></pre></div></p>
<p>Frustrating? No worry. This is a commonly seen error. We can diagnose this problem by checking to see if the dynamic linker is able to gather up all the dependencies at runtime:
<div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>$ ldd use_ctest
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>    linux-vdso.so.1 (0x00007fff56d9d000)
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>    libctest.so =&gt; not found
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>    libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f7f46df6000)
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>    /lib64/ld-linux-x86-64.so.2 (0x00007f7f471bb000)
</span></code></pre></div></p>
<p>The output clearly shows that it does not. The problem here is that the dynamic linker will only search the system default paths. There are a few solutions. </p>
<ul>
<li>
<p>Permanently add our custom library to one of the system default paths. This option needs root permissoins, which is not available for HPC users and thus is not recommended here. </p>
</li>
<li>
<p>Specify the location of libraries using the <code>LD_LIBRARY_PATH</code> environment variable. <code>LD_LIBRARY_PATH</code> contains a colon (:) separated list of directories where the dynamic linker should look for shared libraries. The linker will search these directories before the default system paths. You can define the value of <code>LD_LIBRARY_PATH</code> like so:
<div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>export LD_LIBRARY_PATH=./ctest_dir/lib:$LD_LIBRARY_PATH
</span></code></pre></div>
and then run the program:
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>$ ./use_ctest 
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>100 / 5 = 20
</span></code></pre></div>
It works! </p>
</li>
<li>
<p>Hard-code the location of libraries into the executable. Setting (and forgeting to set) <code>LD_LIBRARY_PATH</code> all the time can be tiresome. An alternative approach is to burn the location of the shared libraries into the executable as an <code>RPATH</code> or <code>RUNPATH</code>. This is done by adding some additional flags for the linker, like so:
<div class="language-text highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>gcc -L ctest_dir/lib use_ctest.o -lctest -Wl,--rpath=ctest_dir/lib -o use_ctest_1
</span></code></pre></div>
We can confirm that this works by running the program:
<div class="language-text highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>$ ./use_ctest_1
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>100 / 5 = 20
</span></code></pre></div>
or examining the executable to show that it contains the needed library:
<div class="language-text highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>$ readelf -d use_ctest_1 |grep ctest
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a> 0x0000000000000001 (NEEDED)             Shared library: [libctest.so]
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a> 0x000000000000000f (RPATH)              Library rpath: [ctest_dir/lib]
</span></code></pre></div></p>
</li>
</ul>
<h2 id="automating-the-build-process-with-gnu-make">Automating the build process with GNU Make</h2>
<p>The manual build process we used above can become quite tedious in real world. There are many ways that we might automate this process. The simplest would be to write a shell script that runs the build commands each time we invoke it. Let's take the simple <em>hello.c</em> program as a test case. Here is a bash shell script (named <em>build.sh</em>) to automate the building process,
<div class="language-text highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>#!/bin/bash
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>gcc -c hello.c
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>gcc hello.o -o hello
</span></code></pre></div>
Run it like so:
<div class="language-text highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>chmod +X build.sh
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>./build.sh
</span></code></pre></div></p>
<p>This works fine for small projects, but for large multi-file projects, we would have to compile all the source codes every time we change anything in the codes.</p>
<p>The GNU Make utility provides a useful way around this problem. The solution is that we (the programmers) write a special script that defines all the dependencies between source files, edit one or more files in our project, then invoke Make to re-compile only those files that have been changed.</p>
<h3 id="how-gnu-make-works">How GNU Make works</h3>
<p>GNU Make is a mini-programming language unto itself. To start, we need to create a file named <em>Makefile</em> or <em>makefile</em> to define a set of tasks to be executed. For the simple <em>hello</em> program, a <em>Makefile</em> is like this:
<div class="language-text highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>hello: hello.o
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>        gcc hello.o -o hello
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>hello.o: hello.c
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>        gcc -c hello.c
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>clean:
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>        rm hello hello.o
</span></code></pre></div></p>
<p>We can see that each section starts with a line specifyting dependency like so: <code>target: prerequisites</code>. The command block that follows will be executed to generate the target if any of the prerequisites have been modified. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Every line in the command block should be started a <code>tab</code> character instead of multiple <code>space</code> characters.</p>
</div>
<p>Once a Makefile is ready, the program can be built by executing one single command,
<div class="language-text highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>make
</span></code></pre></div>
It looks for the <em>Makefile</em> in the same directory and build the targets. The first (top) target will be built by default, or you can specify a specific target to be built, 
<div class="language-text highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>make hello
</span></code></pre></div></p>
<p>When we run <code>make</code>, the computer will take the following actions:</p>
<ol>
<li>
<p>Find the default target, which is our executable <em>hello</em>.</p>
</li>
<li>
<p>Check if the target file <em>hello</em> is up-to-date. A target is considered out-of-date if it does not exist or is older than any of the prerequisites. As <em>hello</em> does not exist, so it will be built.</p>
</li>
<li>
<p>The prerequisite of <em>hello</em> is <em>hello.o</em>, which is also a target, so check if it is up-to-date. As <em>hello.o</em> does not exist, so it will be built.</p>
</li>
<li>
<p>The prerequisite of <em>hello.o</em> is <em>hello.c</em>, which is not a target, so there is nothing left to check. The command <code>gcc -c hello.c</code> will be run to create <em>hello.o</em>.</p>
</li>
<li>
<p>Now <em>hello.o</em> is up-to-date, so the next target <em>hello</em> will be built by running the command <code>gcc hello.o -o hello</code>.</p>
</li>
</ol>
<p>Note that the command under the <em>clean</em> target is not executed by <code>make</code>, because it is neither the first target nor an prerequisite of any other target. To bring it up, we need to specify the target name:
<div class="language-text highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>make clean
</span></code></pre></div>
The command under this target will remove the executable and all of the <code>.o</code> files. Note that if all targets are up-to-date, make does not do anything. </p>
<h3 id="makefile-for-a-multi-file-program">Makefile for a multi-file program</h3>
<p>Now let's switch to the multi-file example program used in previous sections. A <code>Makefile</code> is like this: 
<div class="language-text highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>write: main.o WriteMyString.o
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>        gcc main.o WriteMyString.o -o write
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>main.o: main.c header.h
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>        gcc -c main.c
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>WriteMyString.o: WriteMyString.c
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>        gcc -c WriteMyString.c
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>clean: 
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>        rm write *.o
</span></code></pre></div></p>
<p>For the first build, <code>make</code> builds the targets in the following order: <em>main.o</em>, <em>WriteMyString.o</em>, and <em>write</em>. This compiles all source codes and then links all object files to create the executable. </p>
<p>When the program is rebuilt, <code>make</code> will only build the targets whose prerequisites have been modified since the last build. This feature makes the building process efficient for a program with many source files. For example, if <em>WriteMyString.c</em> is modified, it is recompiled, while <em>main.c</em> is not. If <em>main.c</em> or <em>header.h</em> is modified, only <em>main.c</em> is recompiled, while <em>WriteMyString.c</em> is not. In either case, the <em>write</em> target will be rebuilt, since either <em>main.o</em> or <em>WriteMyString.o</em> is updated.</p>
<p>We need to run <code>make clean</code> and then run <code>make</code>, if we want to completely rebuild evetyhing.</p>
<details>
<summary>Note: silent mode</summary>
<p>By default, <code>make</code> prints on the screen all the commands that it executes. To suppress the print, add an <code>@</code> before the commands, or turn on the silent mode with the option <code>-s</code>:
 <div class="language-text highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>make -s
</span></code></pre></div></p>
</details>
<h3 id="writing-a-good-makefile">Writing a good Makefile</h3>
<p>A <em>Makefile</em> could be very compilcated in a practical program with many source files. It is important that the text in a <em>Makefile</em> should be as simple and clear as possbile. In this section, we will learn more useful features of GNU Make and write a real-world <em>Makrefile</em> at the end.</p>
<p>In our previous examples, you may have noticed that there are many duplications of the same file name or command name. It is convinient to use varialbes in this case. Again, take our multi-file program for example. The <em>Makefile</em> can be rewitten as follows,
<div class="language-text highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>CC=gcc
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>OBJ=main.o WriteMyString.o
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>EXE=write
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>$(EXE): $(OBJ)
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>        $(CC) $(OBJ) -o $(EXE)
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>main.o: main.c header.h
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a>        $(CC) -c main.c
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>
</span><span id="__span-59-11"><a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a>WriteMyString.o: WriteMyString.c
</span><span id="__span-59-12"><a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a>        $(CC) -c WriteMyString.c
</span><span id="__span-59-13"><a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a>
</span><span id="__span-59-14"><a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a>clean:
</span><span id="__span-59-15"><a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a>        rm $(EXE) *.o
</span></code></pre></div></p>
<p>Here we have defined the varialbes <code>CC</code> for the compiler, <code>OBJ</code> for object files, and <code>EXE</code> for the executable file. If we want to change the compiler or the file names, we only modify the corresponding variable at one place. </p>
<p>If there are many varialbes to be defined, it is better to write the definition of all variables in another file, and then include the file in Makefile:
<div class="language-text highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>include ./variables 
</span></code></pre></div>
The file <em>variables</em> reads the following:
<div class="language-text highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>CC=gcc
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>OBJ=main.o WriteMyString.o
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>EXE=write
</span></code></pre></div></p>
<p>Furthermore, we can upgrade the <em>Makefile</em> to a higher automatic level using the so-called automatic variables:
<div class="language-text highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>$(EXE): $(OBJ)
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>        $(CC) $^ -o $@
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>main.o: main.c header.h
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>        $(CC) -c $&lt;
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a>WriteMyString.o: WriteMyString.c
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a>        $(CC) -c $&lt; 
</span></code></pre></div></p>
<p>Here we have used these automatic variables:</p>
<ul>
<li><code>$@</code>  -- the name of the current target</li>
<li><code>$^</code>  -- the names of all the prerequisites</li>
<li><code>$&lt;</code>  -- the name of the first prerequisite</li>
</ul>
<p>These variables automatically take the names of current target or prerequisites, no matter what values are assigned to them.</p>
<p>We then notice that the <em>main.o</em> and <em>WriteMyString.o</em> targets are built by the same command. Is there a way to combine these two duplicated commands into one so as to compile all source code files by only one command line? The answer is yes. It can be done with an implicit pattern rule:
<div class="language-text highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>%.o: %.c
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>        $(CC) -c $&lt;
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>main.o: header.h 
</span></code></pre></div></p>
<p>Here the <code>%</code> stands for the same thing in the prerequisites as it does in the target. Usually, any object file with a subfix <code>.o</code> has a corresponding source file with a subfix <code>.c</code> as an implied prerequisite, so we can use the <code>%</code> to represent the name for both files. If a target (e.g. <em>main.o</em>) needs additional prerequisites (e.g. <em>header.h</em>), write an actionless rule with those prerequisites. We can imagine that applying this impilict rule should significantly simpify a Makefile when there are a large number of source files.</p>
<p>Mostly the target name is a file name. But there are exceptions, such as the <em>clean</em> target in this example. The <code>rm</code> command will not create any file named <code>clean</code>. What if there exists a file named clean in this directory? Let's do an experiment.
<div class="language-text highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>$ touch clean
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>$ make clean
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>make: `clean&#39; is up to date.
</span></code></pre></div></p>
<p>We can see that the clean target does not work properly. Since it has no prerequisite, the target <em>clean</em> will be considered up-to-date, and thus nothing will be done. To solve this issue, we can declare the target to be phony by making it a prerequisite of the special target <code>.PHONY</code> as follows:
<div class="language-text highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>.PHONY: clean
</span></code></pre></div></p>
<p>A phony target is one that is not really the name of a file; rather it is just a name for a recipe to be executed.</p>
<p>In summary, we write a real-world Makefile like so:
<div class="language-text highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>include ./variables
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>.PHONY: clean
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>$(EXE): $(OBJ)
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>        $(CC) $^ -o $@
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>%.o: %.c
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a>        $(CC) -c $&lt;
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a>main.o: header.h
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a>clean:
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a>        rm $(EXE) *.o
</span></code></pre></div></p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">October 3, 2024</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="https://accessibility.mit.edu/">Accessibility</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>